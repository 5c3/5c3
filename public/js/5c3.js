// Generated by CoffeeScript 1.3.3
(function() {
  var FiveC3, top,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  top = this;

  top.replaceHtml = function(el, html) {
    var newEl, oldEl;
    if (typeof el === 'string') {
      oldEl = document.getElementById(el);
    } else {
      oldEl = el;
    }
    newEl = oldEl.cloneNode(false);
    newEl.innerHTML = html;
    oldEl.parentNode.replaceChild(newEl, oldEl);
    return newEl;
  };

  FiveC3 = (function() {

    function FiveC3() {
      this.itemAdded = __bind(this.itemAdded, this);

      this.onItemMouseMove = __bind(this.onItemMouseMove, this);

      this.onItemClick = __bind(this.onItemClick, this);

      this.writtenEvents = __bind(this.writtenEvents, this);

      this.writeEvents = __bind(this.writeEvents, this);

      this.getTemplates = __bind(this.getTemplates, this);

      var templateFiles;
      this.events = [];
      this.typeaheadStrings;
      this.lastFullScreenItem;
      this.player;
      this.templates = {};
      templateFiles = ['item', 'items'];
      this.getTemplates(templateFiles);
    }

    FiveC3.prototype.getTemplates = function(templateFiles) {
      var templateFileName, _i, _len, _results,
        _this = this;
      _results = [];
      for (_i = 0, _len = templateFiles.length; _i < _len; _i++) {
        templateFileName = templateFiles[_i];
        _results.push($.ajax({
          url: '/tpl/' + templateFileName + '.html',
          success: function(dataFromServer) {
            return _this.templates[templateFileName] = doT.template(dataFromServer);
          },
          async: false
        }));
      }
      return _results;
    };

    FiveC3.prototype.writeEvents = function(cb) {
      var items;
      items = this.templates.items(this.events);
      top.replaceHtml("isotopeContainer", items);
      return $('#isotopeContainer').isotope({
        itemSelector: '.item',
        layoutMode: 'masonry',
        animationMode: 'css'
      }, cb);
    };

    FiveC3.prototype.writtenEvents = function(items) {
      var item, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = items.length; _i < _len; _i++) {
        item = items[_i];
        $(item).click(this.onItemClick);
        _results.push($(item).mousemove(this.onItemMouseMove));
      }
      return _results;
    };

    FiveC3.prototype.refreshEventData = function() {
      var _this = this;
      return $.ajax({
        url: 'events',
        datatype: 'json',
        success: function(dataFromServer) {
          _this.events = dataFromServer;
          return _this.writeEvents(_this.writtenEvents);
        },
        async: true
      });
    };

    FiveC3.prototype.onItemClick = function(e) {
      var item;
      if (this.lastFullScreenItem) {
        this.lastFullScreenItem.css('width', '');
        this.lastFullScreenItem.css('height', '');
      }
      item = $(e.target);
      if (!item.hasClass('item')) {
        item = item.parents('.item');
      }
      item.width(740);
      item.height(425);
      $('#isotopeContainer').isotope('reLayout');
      return this.lastFullScreenItem = $(item);
    };

    FiveC3.prototype.onItemMouseMove = function(e) {};

    FiveC3.prototype.itemAdded = function(addedItem) {
      addedItem.click(this.onItemClick);
      return addedItem.mousemove(this.onItemMouseMove);
    };

    return FiveC3;

  })();

  $(document).ready(function() {
    top.fiveC3 = new FiveC3();
    return top.fiveC3.refreshEventData();
  });

}).call(this);
